ord_2018 <- ord_2018 %>% mutate(date=mdy(date))
ord_2019 <- ord_2019 %>% mutate(date=ymd(date))
ord_2020 <- ord_2020 %>% mutate(date=ymd(date))
ord <- bind_rows(ord_2016, ord_2017, ord_2018, ord_2019, ord_2020)
ord <- ord %>%
mutate(year=year(date), month=month(date, label=TRUE), day=day(date), wday=wday(date)) %>%
relocate(year, .after=date) %>%
relocate(month, .after=year) %>%
relocate(day, .after=month) %>%
relocate(wday, .after=day)
ord_2016 <- read.csv("../../data/ORD-2016.csv")
ord_2017 <- read.csv("../../data/ORD-2017.csv")
ord_2018 <- read.csv("../../data/ORD-2018.csv")
ord_2019 <- read.csv("../../data/ORD-2019.csv")
ord_2020 <- read.csv("../../data/ORD-2020.csv")
ord_2016 <- ord_2016 %>% mutate(date=mdy(date))
ord_2017 <- ord_2017 %>% mutate(date=mdy(date))
ord_2018 <- ord_2018 %>% mutate(date=mdy(date))
ord_2019 <- ord_2019 %>% mutate(date=ymd(date))
ord_2020 <- ord_2020 %>% mutate(date=ymd(date))
ord <- bind_rows(ord_2016, ord_2017, ord_2018, ord_2019, ord_2020)
ord <- ord %>%
mutate(year=year(date), month=month(date, label=TRUE), day=day(date), wday=wday(date)) %>%
relocate(year, .after=date) %>%
relocate(month, .after=year) %>%
relocate(day, .after=month) %>%
relocate(wday, .after=day) %>%
subset(ord, terminal)
ord_2016 <- read.csv("../../data/ORD-2016.csv")
ord_2017 <- read.csv("../../data/ORD-2017.csv")
ord_2018 <- read.csv("../../data/ORD-2018.csv")
ord_2019 <- read.csv("../../data/ORD-2019.csv")
ord_2020 <- read.csv("../../data/ORD-2020.csv")
ord_2016 <- ord_2016 %>% mutate(date=mdy(date))
ord_2017 <- ord_2017 %>% mutate(date=mdy(date))
ord_2018 <- ord_2018 %>% mutate(date=mdy(date))
ord_2019 <- ord_2019 %>% mutate(date=ymd(date))
ord_2020 <- ord_2020 %>% mutate(date=ymd(date))
ord <- bind_rows(ord_2016, ord_2017, ord_2018, ord_2019, ord_2020)
ord <- ord %>%
mutate(year=year(date), month=month(date, label=TRUE), day=day(date), wday=wday(date)) %>%
relocate(year, .after=date) %>%
relocate(month, .after=year) %>%
relocate(day, .after=month) %>%
relocate(wday, .after=day) %>%
subset(ord, 'terminal')
ord_2016 <- read.csv("../../data/ORD-2016.csv")
ord_2017 <- read.csv("../../data/ORD-2017.csv")
ord_2018 <- read.csv("../../data/ORD-2018.csv")
ord_2019 <- read.csv("../../data/ORD-2019.csv")
ord_2020 <- read.csv("../../data/ORD-2020.csv")
ord_2016 <- ord_2016 %>% mutate(date=mdy(date))
ord_2017 <- ord_2017 %>% mutate(date=mdy(date))
ord_2018 <- ord_2018 %>% mutate(date=mdy(date))
ord_2019 <- ord_2019 %>% mutate(date=ymd(date))
ord_2020 <- ord_2020 %>% mutate(date=ymd(date))
ord <- bind_rows(ord_2016, ord_2017, ord_2018, ord_2019, ord_2020)
ord <- ord %>%
mutate(year=year(date), month=month(date, label=TRUE), day=day(date), wday=wday(date)) %>%
relocate(year, .after=date) %>%
relocate(month, .after=year) %>%
relocate(day, .after=month) %>%
relocate(wday, .after=day) %>%
select(-terminal)
ord_2016 <- read.csv("../../data/ORD-2016.csv")
ord_2017 <- read.csv("../../data/ORD-2017.csv")
ord_2018 <- read.csv("../../data/ORD-2018.csv")
ord_2019 <- read.csv("../../data/ORD-2019.csv")
ord_2020 <- read.csv("../../data/ORD-2020.csv")
ord_2016 <- ord_2016 %>% mutate(date=mdy(date))
ord_2017 <- ord_2017 %>% mutate(date=mdy(date))
ord_2018 <- ord_2018 %>% mutate(date=mdy(date))
ord_2019 <- ord_2019 %>% mutate(date=ymd(date))
ord_2020 <- ord_2020 %>% mutate(date=ymd(date))
ord <- bind_rows(ord_2016, ord_2017, ord_2018, ord_2019, ord_2020)
ord <- ord %>%
mutate(year=year(date), month=month(date, label=TRUE), day=day(date), wday=wday(date)) %>%
relocate(year, .after=date) %>%
relocate(month, .after=year) %>%
relocate(day, .after=month) %>%
relocate(wday, .after=day) %>%
select(-terminal) %>%
rename(passengers=all_total, flights=all_flights, booths=all_booths)
ord_2016 <- read.csv("../../data/ORD-2016.csv")
ord_2017 <- read.csv("../../data/ORD-2017.csv")
ord_2018 <- read.csv("../../data/ORD-2018.csv")
ord_2019 <- read.csv("../../data/ORD-2019.csv")
ord_2020 <- read.csv("../../data/ORD-2020.csv")
ord_2016 <- ord_2016 %>% mutate(date=mdy(date))
ord_2017 <- ord_2017 %>% mutate(date=mdy(date))
ord_2018 <- ord_2018 %>% mutate(date=mdy(date))
ord_2019 <- ord_2019 %>% mutate(date=ymd(date))
ord_2020 <- ord_2020 %>% mutate(date=ymd(date))
ord <- bind_rows(ord_2016, ord_2017, ord_2018, ord_2019, ord_2020)
ord <- ord %>%
mutate(year=year(date), month=month(date, label=TRUE), day=day(date), wday=wday(date)) %>%
relocate(year, .after=date) %>%
relocate(month, .after=year) %>%
relocate(day, .after=month) %>%
relocate(wday, .after=day) %>%
select(-terminal) %>%
rename(passengers=all_total, flights=all_flights, booths=all_booths) %>%
arrange(date, hour)
str(ord)
ord_2016 <- read.csv("../../data/ORD-2016.csv")
ord_2017 <- read.csv("../../data/ORD-2017.csv")
ord_2018 <- read.csv("../../data/ORD-2018.csv")
ord_2019 <- read.csv("../../data/ORD-2019.csv")
ord_2020 <- read.csv("../../data/ORD-2020.csv")
ord_2016 <- ord_2016 %>% mutate(date=mdy(date))
ord_2017 <- ord_2017 %>% mutate(date=mdy(date))
ord_2018 <- ord_2018 %>% mutate(date=mdy(date))
ord_2019 <- ord_2019 %>% mutate(date=ymd(date))
ord_2020 <- ord_2020 %>% mutate(date=ymd(date))
ord <- bind_rows(ord_2016, ord_2017, ord_2018, ord_2019, ord_2020)
ord <- ord %>%
mutate(year=year(date), month=month(date, label=TRUE), day=day(date), wday=wday(date)) %>%
relocate(year, .after=date) %>%
relocate(month, .after=year) %>%
relocate(day, .after=month) %>%
relocate(wday, .after=day) %>%
select(-terminal) %>%
rename(passengers=all_total, flights=all_flights, booths=all_booths) %>%
arrange(date, hour)
rm(ord_2016, ord_2017, ord_2018, ord_2019, ord_2020)
str(ord)
# Total 29450 Rows and 24 columns
count_na <- function(x){
return (sum(is.na(x)))
}
count_na(ord)
count_na(ord)
count_na <- function(x){
return (sum(is.na(x)))
}
n_missing_data <- summarize_all(count_na(ord))
count_na(ord)
count_na <- function(x){
return (sum(is.na(x)))
}
n_missing_data <- summarize(count_na(ord))
count_na <- function(x){
return (sum(is.na(x)))
}
count_na(ord)
ord %>%
group_by(month, year) %>%
summarize(tot_flights=count(flights), tot_passengers=count(passengers))
ord %>%
group_by(month, year)
ord_summary <- ord %>%
group_by(month, year)
ord_summary <- ord %>%
group_by(month, year)
summarize(ord_summary)
ord_summary <- ord %>%
group_by(month, year)
ord_summary
ord_summary <- ord %>%
group_by(month, year) %>%
summarize(tot_flights=sum(flights), tot_passengers=sum(passengers))
ord_summary
ord_summary <- ord %>%
group_by(month, year) %>%
summarize(tot_flights=sum(flights), tot_passengers=sum(passengers)) %>%
select(year, tot_flights, tot_passengers)
ord_summary
ord_summary <- ord %>%
group_by(month, year) %>%
summarize(tot_flights=sum(flights), tot_passengers=sum(passengers)) %>%
select(year, tot_flights, tot_passengers) %>%
ungroup()
ord_summary
ord_summary <- ord %>%
group_by(month, year) %>%
summarize(tot_flights=sum(flights), tot_passengers=sum(passengers)) %>%
select(year, tot_flights, tot_passengers) %>%
ungroup() %>%
group_by(year)
ord_summary
ord_summary <- ord %>%
group_by(month, year) %>%
summarize(tot_flights=sum(flights), tot_passengers=sum(passengers)) %>%
select(year, tot_flights, tot_passengers) %>%
ord_summary
ord_summary <- ord %>%
group_by(month, year) %>%
summarize(tot_flights=sum(flights), tot_passengers=sum(passengers)) %>%
select(year, tot_flights, tot_passengers)
ord_summary
ord_summary <- ord %>%
group_by(year) %>%
summarize(tot_flights=sum(flights), tot_passengers=sum(passengers)) %>%
select(year, tot_flights, tot_passengers)
ord_summary
ord_summary <- ord %>%
group_by(year, month) %>%
summarize(tot_flights=sum(flights), tot_passengers=sum(passengers)) %>%
select(year, tot_flights, tot_passengers)
ord_summary
ord_summary <- ord %>%
group_by(year) %>%
summarize(tot_flights=sum(flights), tot_passengers=sum(passengers)) %>%
select(year, tot_flights, tot_passengers)
ord_summary
ord_summary2 <- ord %>%
group_by(year, month) %>%
summarize(tot_passengers=sum(passengers)) %>%
select(year, tot_flights, tot_passengers)
ord_summary2 <- ord %>%
group_by(year, month) %>%
summarize(tot_passengers=sum(passengers)) %>%
ggplot(ord_summary2, aes(x=month, y=tot_passengers, fill=month)) %>%
geom_bar()
ord_summary2 <- ord %>%
group_by(year, month) %>%
summarize(tot_passengers=sum(passengers))
ggplot(ord_summary2, aes(x=month, y=tot_passengers, fill=month)) %>%
geom_bar()
ord_summary2 <- ord %>%
group_by(year, month) %>%
summarize(tot_passengers=sum(passengers))
ggplot(ord_summary2, aes(x=month, y=tot_passengers, fill=month)) +
geom_bar()
ord_summary2 <- ord %>%
group_by(year, month) %>%
summarize(tot_passengers=sum(passengers))
ggplot(ord_summary2, aes(x=month, y=tot_passengers, fill=month)) +
geom_bar(stat='identity')
ord_summary2 <- ord %>%
group_by(year, month) %>%
summarize(tot_passengers=sum(passengers))
ggplot(ord_summary2, aes(x=month, y=tot_passengers, fill=year)) +
geom_bar(stat='identity')
ord_summary2 <- ord %>%
group_by(year, month) %>%
summarize(tot_passengers=sum(passengers))
ggplot(ord_summary2, aes(x=month, y=tot_passengers, fill=year)) +
geom_col(position = "dodge")
ord_summary2 <- ord %>%
group_by(year, month) %>%
summarize(tot_passengers=sum(passengers))
ggplot(ord_summary2, aes(x=month, y=tot_passengers, fill=year)) +
geom_col(position = "dodge") +
xlab("Month") +
ylab("Total Passengers") +
scale_y_continuous(label_comma())
ord_summary2 <- ord %>%
group_by(year, month) %>%
summarize(tot_passengers=sum(passengers))
ggplot(ord_summary2, aes(x=month, y=tot_passengers, fill=year)) +
geom_col(position = "dodge") +
xlab("Month") +
ylab("Total Passengers") +
scale_y_continuous(label=comma)
ord_summary2 <- ord %>%
group_by(year, month) %>%
summarize(tot_passengers=sum(passengers))
ggplot(ord_summary2, aes(x=month, y=tot_passengers, fill=year)) +
geom_col(position = "dodge") +
xlab("Month") +
ylab("Total Passengers") +
ggtitle("Number of Passengers Per Month (2016 ~ 2020)")
scale_y_continuous(label=comma)
knitr::opts_chunk$set(echo=TRUE,message=FALSE,warning=FALSE,cache=TRUE,autodep=TRUE,cache.comments=FALSE)
library(tidyverse)
library(readxl)
## Note: this code assumes viridis.R is two steps up the file directory tree in a `scripts` folder
source("../../scripts/viridis.R")
male_05_17 <-  read_excel(
"../../data/Obesity+Prevalence+by+ZIP+Code+and+Age+Group,+Males.xlsx",
sheet=3, skip=5, na=".") # Missing values indicated by a `.`
head(male_05_17)
dim(male_05_17)
male_05_17 <- male_05_17 %>%
select(starts_with("ZIP"),
starts_with("Number"),
starts_with("Population")) %>%
rename(zip = starts_with("ZIP"),
obese = ends_with("Obesity"),
bmi = ends_with("BMI"),
pop = starts_with("Population")) %>%
mutate(sex = "male") %>%
mutate(age = "5-17")
head(male_05_17) # Look at first few observations
rm(male_05_17) # Remove the data frame
read_and_format <- function(file,sex_string,i)
{
age_values <- c("05-17","18-34","35-54","55-74","75-plus")
foo <- read_excel(file, sheet=i+2, skip=5, na=".") %>%
select(starts_with("ZIP"),
starts_with("Number"),
starts_with("Population")) %>%
rename(zip = starts_with("ZIP"),
obese = ends_with("Obesity"),
bmi = ends_with("BMI"),
pop = starts_with("Population")) %>%
mutate(sex = sex_string) %>%
mutate(age = age_values[i])
return(foo)
}
read_obesity <- function()
{
obesity = tibble()
sexes = c("female","male")
files = c("../../data/Obesity+Prevalence+by+ZIP+Code+and+Age+Group,+Females.xlsx",
"../../data/Obesity+Prevalence+by+ZIP+Code+and+Age+Group,+Males.xlsx")
for ( s in 1:2 )
{
for ( i in 1:5 )
{
temp <- read_and_format(files[s],sexes[s],i)
obesity <- bind_rows(obesity,temp)
}
}
return( obesity )
}
obesity <- read_obesity()
head(obesity)
dim(obesity)
ru_orig <- read_csv("../../data/wi_urban_rural.csv")
ru <- read_csv("../../data/wi_urban_rural.csv") %>%
select(Id2,`Urban:`,Rural) %>%
rename(zip = Id2,
urban = `Urban:`,
rural = Rural) %>%
mutate(population = rural + urban) %>%
mutate(p_urban = urban/population)
edu_orig <- read_csv("../../data/wi_education.csv",na=c("(X)","-"))
edu <- edu_orig %>%
select(Id2, #Zipcode
contains("bachelor's degree or higher")) %>%
rename(zip = Id2,
pct_m_bach = `Percent Males; Estimate; Percent bachelor's degree or higher`,
pct_f_bach = `Percent Females; Estimate; Percent bachelor's degree or higher`) %>%
select(-contains("Percent"))
income_orig <- read_csv("../../data/wi_income.csv",na=c("-","**")) # Missing data are indicated by a dash or double asterisk
income <- income_orig %>%
select(Id2,
`Number; Estimate; Households`,
`Median income (dollars); Estimate; Households`) %>%
rename(zip = Id2,
households = `Number; Estimate; Households`,
income = `Median income (dollars); Estimate; Households`)
obesity %>%
count(sex,age)
obesity_wide <- obesity %>%
pivot_wider(
id_cols=zip,
names_from=c(sex,age),
values_from=c(obese,bmi,pop),
names_sep="_"
)
head(obesity_wide)
## Note that obesity has 7740 rows
## (one per zip code/sex/age interval) and the other data frames have
## one row per zip code.
## These columns are replicated as needed to match each row of obesity
obesity <- obesity %>%
left_join(edu, by="zip") %>%
left_join(income, by="zip") %>%
left_join(ru, by="zip")
obesity %>%
filter(zip == "53001")
## Here, both data sets have a row per zip code (there are a few missing rows). Zip codes are matched to add the columns.
obesity_wide <- obesity_wide %>%
left_join(edu, by="zip") %>%
left_join(income, by="zip") %>%
left_join(ru, by="zip")
write_csv(obesity,"../../data/obesity.csv")
write_csv(obesity_wide,"../../data/obesity_wide.csv")
obesity <- read_csv("../../data/obesity.csv") %>%
mutate(adult = age != "05-17") # indicator for adult
## work with obesity data before joining
## Caution:  this *assumes* that the obesity proportions from the study can be extrapolated to the population
obesity <- obesity %>%
mutate(obese_n = pop * (obese/bmi))
obesity %>%
select(obese_n,pop) %>%
drop_na() %>%
summarize(obese_p = sum(obese_n)/sum(pop))
obesity %>%
group_by(sex) %>%
select(obese_n,pop) %>%
drop_na() %>%
summarize(obese_p = sum(obese_n)/sum(pop))
obesity %>%
group_by(age) %>%
select(obese_n,pop) %>%
drop_na() %>%
summarize(obese_p = sum(obese_n)/sum(pop))
obesity %>%
group_by(age,sex) %>%
select(obese_n,pop) %>%
drop_na() %>%
summarize(obese_p = sum(obese_n)/sum(pop)) %>%
pivot_wider(id_cols=age, names_from=sex, values_from=obese_p)
obesity %>%
group_by(age,sex) %>%
select(obese_n,pop) %>%
drop_na() %>%
summarize(obese_p = sum(obese_n)/sum(pop)) %>%
ungroup() %>%
ggplot(aes(x = age, y = obese_p, fill = sex)) +
geom_col(position = "dodge") # dodge = separating bars
ru <- obesity %>%
select(zip,rural,urban,population) %>%
distinct()
ru %>%
summarize(total_r = sum(rural),
total_u = sum(urban),
total = sum(population),
p_rural = total_r/total,
p_urban = total_u/total)
ru2 <- obesity %>%
filter(adult == TRUE) %>%
select(zip,obese,bmi,pop,sex,age,rural,urban,population) %>%
drop_na() %>%
mutate(obese_n = obese/bmi*pop, #this *assumes* the obesity proportions from the study can be extrapolated to the population
obese_p = obese/bmi,
non_obese_n = pop - obese_n,
p_rural = rural/population,
p_urban = urban/population,
obese_r = obese_n * p_rural,
obese_u = obese_n * p_urban,
non_obese_r = non_obese_n * p_rural,
non_obese_u = non_obese_n * p_urban)
ru2 %>%
select(obese_r,obese_u,non_obese_r,non_obese_u) %>%
summarize_all(sum) %>%
summarize(prevalence_r = round(obese_r/(obese_r + non_obese_r),3),
prevalence_u = round(obese_u/(obese_u + non_obese_u),3))
ggplot(ru2, aes(x=100*p_urban,y=100*obese_p,color=sex,shape=age)) +
geom_point(position = position_jitter(width=1,height=0), alpha=0.2) + # alpha = make it more transparent
geom_smooth(se=FALSE) +
xlab("Percentage Urban") +
ylab("Percentage Obese") +
ggtitle("Wisconsin Obesity by Zipcode") +
facet_grid(. ~ age)
# Calculate adult obesity percentages by zip code
obesity1 <- obesity %>%
filter(adult) %>%
select(zip,obese_n,pop) %>%
drop_na() %>%
group_by(zip) %>%
summarize(obese_pct = 100*sum(obese_n) / sum(pop))
obesity1
wi_zip <- read_csv("../../data/wi_zip.csv") %>%
mutate(zip=as.character(zip))
obesity1 <- obesity1 %>%
left_join(wi_zip, by="zip")
obesity1 <- obesity1 %>%
left_join(wi_zip, by="zip")
wi_zip <- read_csv("../../data/wi_zip.csv") %>%
mutate(zip=as.character(zip))
obesity1 <- obesity1 %>%
left_join(wi_zip, by="zip")
library(ggmap)
library(ggmap)
library(mapproj)
wi <- map_data('state',region='wisconsin')
# Data from `wi`
ggplot() +
geom_point(data=wi,
mapping=aes(x=long,y=lat),
fill="white",
color="black")
ggplot() +
geom_polygon(data=wi,
mapping=aes(x=long,y=lat),
fill="white",
color="black") +
coord_map() +
geom_point(data=obesity1,
mapping=aes(x=longitude,y=latitude,color=obese_pct),
size=2,alpha=0.5) +
guides(color = guide_legend("Obesity %")) +
theme_void()+
ggtitle("Wisconsin Percentage Obese",
subtitle="by zip code")
wi
View(wi)
ggplot() +
geom_point(data=wi,
mapping=aes(x=long,y=lat),
fill="white",
color="black")
ggplot() +
geom_polygon(data=wi,
mapping=aes(x=long,y=lat),
fill="white",
color="black")
ggplot() +
geom_polygon(data=wi,
mapping=aes(x=long,y=lat),
fill="white",
color="black") +
coord_map()
ggplot() +
geom_polygon(data=wi,
mapping=aes(x=long,y=lat),
fill="white",
color="black") +
coord_map() +
geom_point(data=obesity1,
mapping=aes(x=longitude,y=latitude,color=obese_pct),
size=2,alpha=0.5)
ru <- obesity %>%
select(zip,rural,urban,population,households) %>%
distinct() %>%
mutate(rural_pct = 100*rural/(rural+urban)) %>%
left_join(wi_zip, by="zip")
